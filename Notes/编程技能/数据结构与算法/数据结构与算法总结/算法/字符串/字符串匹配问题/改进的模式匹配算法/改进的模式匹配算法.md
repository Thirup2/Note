# 一. 问题分析

实际上在前面的KMP模式匹配算法中，仍然存在问题。

如果待匹配字符串有多个连续字符相同，当最后一个相同字符匹配失败时，我们就应该直接从该字符后再重新开始匹配，而在之前的KMP模式匹配算法中，待匹配字符串只会一个字符一个字符地移动。

所以推导`next`数组的方法还可以改进。



# 二. 代码描述

```c
void get_next(CSTRING string, size_char *next)
{
    size_char i, k;
    i = 1;
    k = 0;
    next[1] = 0;
    while (i < string[0]) {
        if (k == 0 || string[i] == string[k]) {
            ++i;
            ++k;
            if (string[i] != string[k]) {
                next[i] = k;
            } else {
                next[i] = next[k];
            }
        } else {
            k = next[k];
        }
    }
}
```

