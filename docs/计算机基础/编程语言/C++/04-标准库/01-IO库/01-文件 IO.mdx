## 一、使用文件 IO

头文件`fstream`定义了三个类型来支持文件 IO：`ifstream`从一个给定文件读取数据，`ofstream`向一个给定文件写入数据，以及`fstream`可以读写给定文件。

文件 IO 的操作除了继承自`iostream`类型的行为之外，`fstream`中定义的类型还增加了一些新的成员来管理与流关联的文件，这些操作如下所示：

| 操作                                                         | 效果                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `fstream fstrm`（`fstream`是一个文件 IO 类型；`fstrm`是一个文件 IO 对象） | 创建一个未绑定的文件流                                       |
| `fstream fstrm(s)`                                           | 创建一个文件流，并打开名为`s`的文件。<br />`s`可以是`string`类型，或者是一个指向 C 风格字符串的指针<br />默认的文件打开`mode`依赖于`fstream`的类型 |
| `fstream fstrm(s, mode)`                                     | 与前一个构造函数类似，但按指定`mode`打开文件                 |
| `fstrm.open(s)`                                              | 打开名为`s`的文件，并将文件与`fstrm`绑定。<br />`s`可以是一个`string`或指向 C 风格字符串的指针<br />默认的文件`mode`依赖于`fstream`的类型，返回`void` |
| `fstrm.open(s, mode)`                                        | 与前一个成员函数类似，但按指定`mode`打开文件                 |
| `fstrm.close()`                                              | 关闭与`fstream`绑定的文件，返回`void`                        |
| `fstrm.is_open()`                                            | 返回一个`bool`值，指出与`fstrm`关联的文件是否成功打开且尚未关闭 |



## 二、对基类形参使用继承类实参

在要求使用基类对象的地方，我们可以用继承类型的对象来替代。

如果函数接受一个`iostream`类型的引用或指针，可以用一个对应的`fstream`或`ssgream`类型来调用。例如，如果有一个函数接受一个`ostream&`参数，我们在调用这个函数时，可以传递给他一个`ofstream`对象，对`istream &`和`ifstream`也是类似的。



## 三、注意事项

- 如果我们定义了一个空文件流对象，可以随后调用`open`来将它与文件关联起来。而如果调用`open`失败，`failbit`会被置位。所以进行`open`是否成功的检测通常是一个好习惯。
- 一旦一个文件流已经打开，它就保持与对应文件的关联。实际上，对一个已经打开的文件流调用`open`会失败，并会导致`failbit`被置位。为了将文件流关联到另一个文件，必须首先关闭已经关联的文件。
- 流对象和其他名字一样，在离开作用域时会自动被销毁，销毁时会自动调用`close`函数



## 四、文件模式

每个文件流类型都有一个关联的**文件模式**，用来指出如何使用文件，所有的文件模式如下所示：

| 模式     | 方式                         |
| -------- | ---------------------------- |
| `in`     | 以读方式打开                 |
| `out`    | 以写方式打开                 |
| `app`    | 每次写操作前均定位到文件末尾 |
| `ate`    | 打开文件后立即定位到文件末尾 |
| `trunc`  | 截断文件                     |
| `binary` | 以二进制方式进行 IO          |

这些文件模式各有限制条件，并且某些文件模式可以混合使用，具体的规则如下：

- 只可以对`ofstream`或`fstream`对象设定`out`模式
- 只可以对`ifstream`或`fstream`对象设定`in`模式
- 只有当`out`也被设定时才可以设定`trunc`模式，如果不设定`trunc`模式，单独以`out`模式打开的文件也是默认以`trunc`模式进行。
- 只要`trunc`没被设定，就可以设定`app`模式。`app`模式可以单独指定，也可以和`out`一起指定，如果单独指定，那么将默认以`out`方式打开
- `ate`和`binary`模式可用于任何类型的文件流对象，且可以与其他任何文件模式组合使用。
- 只有`fstream`对象可以同时设定`out`和`in`模式，即打开文件同时进行读写操作

每个文件流类型都定义了一个默认的文件模式，当我们未指定文件模式时，就使用此默认模式：

- 与`ifstream`关联的文件默认以`in`模式打开
- 与`ofstream`关联的文件默认以`out`模式打开
- 与`fstream`关联的文件默认以`in`和`out`模式打开

### 组合多模式的方式

文件模式也是位模式，所以组合使用多种文件模式的方法就是使用位或运算符（`|`）：

```cpp
ofstream out("file", ofstream::out | ofstream::trunc);
```