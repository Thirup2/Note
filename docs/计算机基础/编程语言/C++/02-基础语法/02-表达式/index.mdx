---
title: 表达式
---

## 一、简介

**表达式**由一个或多个**运算对象**组成，对表达式求值将得到一个**结果**，字面值和变量是最简单的表达式，其结果就是字面值和变量的值。把一个**运算符**和一个或多个运算对象组合起来可以生成比较复杂的表达式。

C++ 定义了**一元运算符**和**二元运算符**，以及一个**三元运算符**。并且有些相同的运算符表示不同的含义。

另外，表达式可以进行组合从而变成复杂的表达式。一个复杂的表达式中包含了多个运算符，想要得出这个表达式的值我们需要理解运算符的**优先级**、**结合律**以及运算对象的**求值顺序**，另外还有一些运算对象的默认类型转换。

在 C++ 中，我们可以在自定义类中重新定义运算符作用在自定义类对象上时的含义，称为运算符的重载，被重载的运算符称作**重载运算符**。例如标准 IO 库中的`<<`和`>>`运算符。



## 二、值的类型

在表达式中有两种值的类型：**左值**（lvalue）和**右值**（rvalue）。不同的运算符对运算对象的要求各不相同，有的需要左值运算对象，有的需要右值运算对象。返回值也有差异，有的返回左值结果，有的返回右值结果。

一个左值表达式的求值结果一定是一个对象或者一个函数。但一个对象或者函数可能是一个右值而非左值。

简单来说，当一个对象在内存中的地址能够被使用时，它就是一个左值，其余情况就是右值。通常在需要右值的地方可以使用左值来代替，因为左值在内存中的位置可以使用，其值也可以使用，而右值则不一定可以当作左值使用，例如字面值常量只有其值可以使用，而不能访问或改变其在内存中的位置（即内存中的位置不可用，也即无法作为左值使用）。

:::info C 语言中的左值和右值

C++ 中左值和右值这两个名词实际继承自 C 语言，原本是为了帮助记忆：左值可以位于赋值语句的左侧，右值则不能位于赋值语句的左侧。

在 C++ 中这两个词实际的含义和原本的含义有所不同。在 C 语言中判断方法非常简单，以常量对象为例，由于不能将其放在赋值语句左侧，所以这是一个 C 语言中的右值而不是左值。而在 C++ 中，一个常量对象在内存中的地址能够被使用（如取地址操作`&c`），所以这是一个 C++ 中的左值但却不能放在赋值语句的左边。

在 C++ 中值的类型的概念与表达式息息相关，一个运算符所接受的运算对象和返回的值都明确了其值的类型。

:::



## 三、表达式求值

### 1. 优先级

运算符具有不同的优先级属性，在一个复合表达式中，优先级高的运算符将优先得到计算。括号`()`具有最高的优先级，如果不清楚运算符的优先级属性，可以使用括号强制其先行计算，内层括号比外层括号更优先。

以简单四则运算为例，`a + b * c`这个表达式，由于`*`比`+`优先级更高，所以这个表达式等价于`a + (b * c)`



### 2. 结合律

每个运算符都有其结合律属性，在一个复合表达式中，如果并列多个相同优先级的运算符，则根据这些运算符的结合律决定哪个运算符优先得到计算。结合律决定相同优先级的多个运算符从左往右执行或者从右往左执行。

以赋值语句为例，由于其结合律为从右往左，所以可以写出下面的式子：

```cpp
int a, b, c;
a = b = c = 10;
```

赋值语句从右往左执行，同时每一次执行返回左侧运算对象，所以先给`c`赋值，然后用`c`给`b`赋值，再用`b`给`a`赋值，所有变量都等于 10。而如果我们假设赋值语句从左往右执行，`b`首先赋值给`a`，但`b`现在是个垃圾值，所以`a`就成了垃圾值，如果赋值语句仍然返回左侧运算对象，那么这个表达式运行到最后，`b`和`c`都不会得到改变，`a`先后得到`b`和`c`的垃圾值，最后被赋值为 10。



### 3. 求值顺序

优先级和结合律其实只规定了运算对象的组合方式，并没有说明运算对象按照什么顺序求值。

例如

```cpp
int i = j + k * f();
```

根据优先级我们可以轻松判断出应该先计算`k * f()`，可是先计算`k`还是先计算`f()`这并没有进行规定，这就是求值顺序。如果先计算了`f()`，假设`f()`函数会导致`k`被改变，那么后计算的`k`就不一定是我们想象中的`k`了。另外，对于优先级更低的`+`本身，可以把整个表达式看成两部分，即`j`和`k * f()`，那么先求`j`的值还是先求`k * f()`的值也是不确定的。

再例如

```cpp
cout << i << " " << ++i << endl;
```

在一串相同运算符`<<`构成的表达式中，可以从整个表达式提取出等价的几个部分：`cout`，`i`，`" "`，`++i`，`endl`。虽然它们被`<<`运算符的结合律规定需要从左往右进行结合，但这些等价的部分哪一个先进行求值则是不确定的。如果先对`++i`进行了求值，那毫无疑问`i`将被修改。

之所以求值顺序不受优先级和结合律影响是因为实际上表达式应该先按照求值顺序对各个等价部分进行求值之后，再按照优先级和结合律执行运算符的功能。而大多数运算符都并未规定其求值顺序，这取决于编译器，所以保持下面的原则非常重要：如果改变了某个运算对象的值，在表达式的其他地方不要再使用这个运算对象。

所有运算符中规定了求值顺序的只有 4 个：`&&`、`||`、`?:`、`,`



### 4. 隐式类型转换

具体内容见[隐式类型转换](隐式类型转换/)
