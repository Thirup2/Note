---
title: 关联容器
---

## 一、概述

关联容器总的来说只有两个：`map`和`set`，其中`map`中的每一个元素都是一个键值对，包括两个类型可能不同的数据，而`set`中的每一个元素只包含一个关键字。

具体分类下来，一共有两个大类，八种类型：

- 有序关联容器（按关键字排序）

  | 容器       | 意义                    |
  | ---------- | ----------------------- |
  | `map`      | 关联数组。保存键值对    |
  | `set`      | 只保存关键字的容器      |
  | `multimap` | 关键字可重复出现的`map` |
  | `multiset` | 关键字可重复出现的`set` |

- 无序关联容器（用哈希组织）

  | 容器                 | 意义                       |
  | -------------------- | -------------------------- |
  | `unordered_map`      | 用哈希函数组织的`map`      |
  | `unordered_set`      | 用哈希函数组织的`set`      |
  | `unordered_multimap` | 用哈希函数组织的`multimap` |
  | `unordered_multiset` | 用哈希函数组织的`multiset` |

其中有序关联容器中的“序”和顺序容器中的“序”是不同的，顺序容器是加入容器的顺序，而有序关联容器则是按关键字大小排出的顺序。

`map`和`multimap`定义在`<map>`中；`set`和`multiset`定义在`<set>`中；无序容器则定义在`<unordered_map>`和`<unordered_set>`中。

:::info 关联容器的用途

关联容器最强大的是其按值查找能力。

对于顺序容器来说，其插入时并不按元素值进行排列，所以如果要按值查找，要么遍历整个容器，要么先对该容器进行排序，然后再用更好的查找算法进行查找。

而关联容器，首先是有序关联容器，在插入时就按照关键字的顺序进行了排列，所以在查找时就可以直接使用优异的查找算法进行查找而无需二次排序。有序关联容器中的`map`主要用途是保存键值对，可以用来保存一些有映射关系的内容，例如销售单号和该单的销售记录。而`set`更像是顺序容器特化了按值查找功能之后的数据结构，它和顺序容器一样每个元素只保存一个值，但它和顺序容器不同的是再插入时会按这些元素的值选择合适的位置插入，而更习惯把`set`保存的值称之为关键字而不是值。

对于无序关联容器，它们在按值查找方面就更加强大了，因为它们使用了哈希函数进行组织。哈希函数是一种自定义的算法（当然现在有几种比较常用的算法），可以用它来建立一个关键字与索引的一一对应关系，假设我首先有一个正常的数组可以用整数下标进行随机访问，然后在保存一个键值对时首先根据关键字通过自定义的哈希函数（对于不同关键字计算得出的值要尽可能不同）计算一个下标值，然后就将这个键值对保存在这个下标对应的位置。然后我们在查找时输入一个关键字，查找函数仍然首先根据这个关键字通过相同的哈希函数进行计算，再次得出上面那个下标值，然后就可以直接通过这个下标进行访问了，从而实现了常数级别的查找算法。

:::



## 二、基本使用

### 1. 使用 map

`map`是键值对的集合，例如可以将一个人的名字作为关键字，将其电话号码作为值。`map`类型通常被称为**关联数组**，它与“正常”数组类似，不同之处在于其下标不必是整数。我们通过一个关键字而不是位置来查找值。给定一个名字到电话号码的`map`，我们可以使用一个人的名字作为下标来获取此人的电话号码。

示例代码如下：

```cpp
// 统计每个单词在输入中出现的次数
map<string, size_t> word_count;
string word;
while(cin >> word)
    ++word_count[word];
for(const auto &w : word_count)
    cout << w.first << " occurs" << w.second
    	<< ((w.second > 1) ? " times" : " time") << endl;
```

- `map`的实例化需要使用两个类型参数才能实例化，第一个参数就是所谓的关键字，也是对该类型`map`对象进行下标运算时需要使用的下标类型，第二个参数是值的类型。
- `map`的每个元素都是一个键值对，实际上是一个`pair`类型的对象，而这个元素类型对用户是`public`的，我们可以使用`.first`和`.second`来直接访问这两个元素。
- `map`的下标操作将返回该关键字对应的值的引用。



### 2. 使用 set

`set`用来单纯保存一组关键字，当只是想知道一个值是否存在时，`set`是最有用的。

示例代码如下：

```cpp
// 统计输入中除了排除列表之外的每个单词出现的次数
map<string, size_t> word_count;
// highlight-start
set<string> exclude = {"The", "But", "And", "Or", "An", "A",
                       "the", "but", "and", "or", "an", "a"};
// highlight-end
string word;
while (cin >> word) 
	if (exclude.find(word) == exclude.end())
        ++word_count[word];
```

- `set`在实例化时提供的类型参数只需要一个作为关键字
- `set`的按值查找通过`find`和`end`两个成员函数进行，它们返回查找值所在的迭代器和尾后迭代器。
