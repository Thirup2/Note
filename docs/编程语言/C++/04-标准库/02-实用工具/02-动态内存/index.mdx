---
title: 动态内存
---

一个 C++ 程序通常管理两块内存，一块被称作**栈**，是最常用的内存。另一块被称作**堆**，也叫做自由空间，在这个空间上分配的对象由程序来管理，并不会自动释放，也就是说，当动态对象不再使用时，我们的代码必须显式地销毁他们。

在 C++ 中，动态内存的管理是通过一对运算符来完成的：`new`和`delete`，它们的工作分别是为对象分配空间并返回一个指向该对象的指针、接受一个动态对象的指针并销毁该对象释放与之关联的内存。

一个非常常见的问题是无法确保动态分配的内存能够在正确的时间释放，以及有时我们会忘记释放内存。C++ 和 C 语言一样，其或多或少沿承了 C 语言的设计哲学，其中之一就是尽量相信程序员不会犯错，从而为了使程序得到更好的性能，C++ 将动态内存的管理这个重任就交给程序员了。

对于类设计者来说，如果动态内存的管理能完全封装在库中也还能接受，对于用户来说不需要来管理内存，但事实是内存管理很可能需要渗透到用户的使用中，可能会由于用户的疏忽导致问题的出现，导致库的易用性和安全性都大打折扣。

为了解决这个问题，标准库提供了两种智能指针类型来管理动态对象，它的行为类似常规指针，但它可以自动释放所指向的对象。这两个智能指针类型分别是：`shared_ptr`和`unique_ptr`。

- `shared_ptr`允许多个指针指向同一个对象
- `unique_ptr`“独占”所指向的对象

另外，标准库还定义了一个名为`weak_ptr`的伴随类，它是一种弱引用，指向`shared_ptr`所管理的对象。

以上三种类型都定义在`<memory>`头文件中。
