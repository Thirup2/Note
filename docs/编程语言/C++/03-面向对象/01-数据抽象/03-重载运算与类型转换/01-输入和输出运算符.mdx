## 一、重载输出运算符`<<`

- 函数类型：非成员函数

- 参数：第一个形参为非常量`ostream`对象的引用；第二个形参一般来说是一个常量的引用，该常量是我们想要打印的类类型。

  > 第一个形参之所以是非常量是因为向流写入内容会改变其状态；而之所以是引用是因为我们无法直接复制一个`ostream`对象；
  >
  > 第二个形参之所以是引用是因为我们希望避免复制实参；而之所以该形参可以是常量是因为通常情况下打印对象不会改变对象的内容。

- 返回值：接受的`ostream`形参

**示例**：

```cpp
ostream &operator<<(ostream &os, const Sales_data &item)
{
    os << item.isbn() << " " << item.units_sold << " "
        << item.revenue << " " << item.avg_price();
    return os;
}
```

:::info 输出运算符尽量减少格式化操作

用于内置类型的输出运算符不太考虑格式化操作，尤其不会打印换行符，用户希望类的输出运算符也像如此行事。如果运算符打印了换行符，则用户就无法在对象的同一行内接着打印一些描述性的文本了。相反，令输出运算符尽量减少格式化操作可以使用户有权控制输出的细节。

:::



## 二、输入运算符

- 函数类型：非成员函数
- 参数：第一个形参是`istream`的非常量引用，第二个形参是非常量对象的引用
- 返回值：返回传入的`istream`对象的引用

**示例**：

```cpp
istream &operator>>(istream &is, Sales_data &item)
{
    double price;
    is >> item.bookNo >> item.units_sold >> price;
    if (is)											// 检查是否输入成功
        item.revenue = item.units_sold * price;
    else
        item = Sales_data();						// 输入失败时将对象置于默认状态
    return is;
}
```

:::info 输入时的错误处理

输入运算符必须处理输入可能失败的情况，而输出运算符不需要。

在执行输入运算符时可能发生下列错误：

- 当流含有错误类型的数据时读取操作可能失败。例如在读取完`bookNo`后，输入运算符假定接下来读入的是两个数字数据，一旦输入的不是数字数据，则读取操作及后续对流的其他使用都将失败。
- 当读取操作到达文件末尾或者遇到输入流的其他错误时也会失败

当读取操作发生错误时，输入运算符应该负责从错误中恢复，通常是将对象置于合法的状态

另外，一些输入运算符需要做更多数据验证的工作。例如，我们的输入运算符可能需要检查`bookNo`是否符合规范的格式。即使 IO 操作成功了，如果输入数据的格式不正确，也应该设置流的条件状态以标示出失败信息。通常情况下，输入运算符只设置`failbit`。

:::