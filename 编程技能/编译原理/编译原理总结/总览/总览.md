# 一. 语言处理器

**编译器**或**解释器**都是常见的**语言处理器**。

编译器执行的工作就是将源程序翻译为目标程序；而解释器执行的工作是每一次执行都将源程序逐语句翻译并执行。

在经典的编译过程中，一个源程序往往会经历以下几个过程：

- 预处理：由预处理器执行，用于将所有源程序聚合在一起
- 编译：由编译器执行，用于将经过预处理的源程序编译成目标汇编程序
- 汇编：由汇编其执行，用于将目标汇编程序汇编为可重定位机器代码
- 链接：由连接器执行，用于将相关的可重定位对象文件链接起来最后得到目标机器代码

上面的每一个过程都是语言处理的过程，即四个过程中涉及到的每一个程序都是一个语言处理器。



# 二. 编译器的结构

编译器由两部分组成：**分析部分**和**综合部分**。

**分析**（analysis）部分把源程序分解成为多个组成要素，并在这些要素之上加上语法结构。然后，它使用这个结构来创建该源程序的一个中间表示。如果分析部分检查出源程序没有按照正确的语法构成，或者语义上不一致，它就必须提供有用的信息，使得用户可以按此进行改正。分析部分还会收集有关源程序的信息，并把信息存放在一个称为**符号表**（symbol table）的数据结构中。符号表将和中间表示形式一起传送给综合部分。

**综合**（synthesis）部分根据中间表示和符号表中的信息来构造用户期待的目标程序。分析部分经常被称为编译器的**前端**（front end），而综合部分称为**后端**（back end）。

而编译过程则是顺序地执行了一组步骤，每个步骤把源程序的一种表示方式转换成另一种表示方式。一种典型的把编译程序分解成为多个步骤的方式如下所示：

<br />


$$
字符流\stackrel{词法分析器}{\longrightarrow}符号流\stackrel{语法分析}{\longrightarrow}语法树\stackrel{语义分析}{\longrightarrow}语法树\stackrel{中间代码生成器}{\longrightarrow}中间表示形式\stackrel{机器无关代码优化器}{\longrightarrow}中间表示形式\stackrel{代码生成器}{\longrightarrow}目标机器语言\stackrel{机器相关代码优化器}{\longrightarrow}目标机器语言
$$




<br />

有些编译器在前端和后端之间有一个与机器无关的优化步骤。这个优化步骤的目的是在中间表示之上进行转换，以便后端程序能够生成更好的目标程序。如果基于未经过此优化步骤的中间表示来生成代码，则代码的质量会受到影响。因为优化是可选的，所以上述步骤中的两个优化步骤之一可以被省略。

下面对各个步骤进行详细的讨论：

## 1. 词法分析

**词法分析**（lexical analysis）也叫做**扫描**（scanning）。

词法分析器读入组成源程序的字符流，并且将它们组织成有意义的**词素**（lexeme）的序列。对于每个词素，语法分析器产生如下形式的**词法单元**（token）作为输出：

```
<token-name, attribute-value>
```

这个词法单元将被传送给下一个步骤，即语法分析。在这个词法单元中，第一个分量`token-name`是一个由语法分析步骤使用的抽象符号，而第二个分量`attribute-value`指向符号表中关于这个词法单元的条目。符号表条目的信息会被语义分析和代码生成步骤使用。

例如，假设一个源程序包含如下的赋值语句：

```
position = initial + rate * 60
```

这个赋值语句中的字符可以组合成如下词素，并映射成如下词法单元：

- `position`是一个词素，被映射成词法单元`<id, 1>`，其中`id`是表示**标识符**（identifier）的抽象符号，而 1 指向符号表中 `position`对应的条目。一个标识符对应的符号表条目存放该标识符有关的信息，比如它的名字和类型。
- 赋值符号`=`是一个词素，被映射成词法单元`<=>`。因为这个词法单元不需要属性值，所以省略了第二个分量。也可以使用`assign`这样的抽象符号作为词法单元的名字，但是为了标记上的方便，我们选择使用词素本身作为抽象符号的名字
- `initial`是一个词素，被映射成词法单元`<id, 2>`，其中 2 指向`initial`对应的符号表条目。
- `+`是一个词素，被映射成词法单元`<+>`
- `rate`是一个词素，被映射成词法单元`<id, 3>`，其中 3 指向`rate`对应的符号表条目。
- `*`是一个词素，被映射成词法单元`<*>`
- `60`是一个词素，被映射成词法单元`<60>`。从技术上讲，`60`应该建立一个形如`<number, 4>`的词法单元，但这里简单起见，记作`<60>`

分隔词素的空格会被词法分析器忽略掉。

在经过词法分析之后，原语句被表示成如下的词法单元序列：

```
<id, 1> <=> <id, 2> <+> <id, 3> <*> <60>
```

然后将这个词法单元序列传送给语法分析器。以上就是词法分析器所做的工作。