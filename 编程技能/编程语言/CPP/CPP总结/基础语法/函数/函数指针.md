# 一. 定义方法

函数指针指向函数而非对象。函数的类型由它的返回类型和形参类型共同决定，与函数名无关。

假设指向的函数的返回类型是`RetType`，参数列表为`Para-List`，那么一个指向函数的指针应该像下面这样声明：

```c++
RetType (*PtoFun)(Para-List) = &Fun;
```

其中`PtoFun`就是指针的名字，`*`表示它是个指针。然后`(*PtoFun)`与后面的`()`结合，表示`(*PtoFun)`是一个接受`Para-List`的函数，`RetType`是指向的函数的返回类型。



# 二. 使用函数指针

当我们把函数名作为一个值使用时，该函数自动转换成指针，如：

```c++
pf = lengthCompare;
pf = &lengthCompare;		// 与上一条表达式等价
```

此外，我们还能直接使用指向函数的指针调用该函数，无须提前解引用指针：

```c++
bool b1 = pf("hello", "goodbye");
bool b2 = (*pf)("hello", "goodbye");		// 与上一条调用等价
bool b3 = lengthCompare("hello", "goodbye");	// 与前面的表达式等价
```

另外，指向不同函数类型的指针间不存在转换规则。但是和往常一样，我们可以为函数指针赋一个`nullptr`或者值为 0 的整型常量表达式，表示该指针没有指向任何一个函数。

## 1. 重载函数的指针

由于重载函数在形参列表（一定）和返回类型上（可能）存在区别，所以重载函数集合中的每一个函数的函数指针类型都不同，所以并不会产生任何歧义。

如：

```c++
void ff(int *);
void ff(unsigned int);

void (*pf1)(unsigned int) = ff;
void (*pf2)(int *) = ff;
```

虽然用作两个指针的初始值的都是`ff`，但是可以根据指针类型确定作为初始值的具体是哪一个函数。



## 2. 函数指针形参

函数形参可以是指向函数的指针。

如下所示：

```c++
void useBigger(const string &s1, const string &s2, bool pf(const string &, const string &));
void useBigger(const string &s1, const string &s2, bool (*pf)(const string &, const string &));		// 与上一条声明等价
```

需要注意要熟悉函数指针的声明形式。



## 3. 返回指向函数的指针

返回指向函数的指针写在函数中看起来比较复杂：

```c++
bool (*pf(const string &s1, const string &s2))(const string &, const string &);
```

需要注意：

`pf`首先后面的`()`结合，表示是个函数，接受的参数为两个`const string &`；然后与`*`结合，表示函数返回的是一个指针；再与最后的`(const string &, const string &)`结合，表示函数返回的是一个函数指针，这个函数接受两个`const string &`参数，最后`bool`表示函数返回的函数指针的返回类型是`bool`类型。

可以使用尾置返回类型的方式来简化这个声明：

```c++
auto pf(const string &s1, const string &s2) -> bool (*)(const string &, const string &);
```



# 三. 简化

## 1. 类型别名

```c++
typedef bool (*Func)(const string &, const string &);
using Func = bool (*)(const string &, const string &);
```



## 2. decltype

如果我们明确知道返回的函数是哪一个，就能使用`decltype`简化书写函数指针返回类型的过程。

如：

```c++
string::size_type sumLength(const string &, const string &);
string::size_type largerLength(const string &, const string &);

decltype(sumLength) *getFcn(const string &);
```

**注意**：`decltype`严格返回`sumLength`的类型，所以必须添加一个`*`符号表示返回的是指向函数的指针。



## 3. 尾置返回类型

即：

```c++
auto pf(const string &s1, const string &s2) -> bool (*)(const string &, const string &);
```

的形式。