# 一. 简介

一个复杂表达式中通常都有两个及以上操作符存在，在多个操作符之间，我们应该先执行哪个操作符和其操作数的运算主要由下面几点确定：

1. 优先级：运算符具有优先级，对于同一个表达式中的不同优先级的操作符，我们应该先执行优先级较高的操作符和其操作数的运算。
2. 结合律：对于同一个表达式中的相同优先级的操作符，我们应该先执行哪个操作符的运算由运算符的结合律确定，通常同一优先级的操作符其结合律也相同。举例来说，对于具有右结合律的操作符来说，多个相同优先级的操作符应该先执行最右边的一个操作符和其操作数的运算。
3. 求值顺序：对于单个操作符和其操作数来说，如果该操作符的操作数在两个及以上，求值顺序则会影响表达式的值。求值顺序决定了单个操作符的多个操作数中哪个操作数应该先进行求值。大部分的操作符都未定义其求值顺序，但有 4 种操作符进行了定义。
4. 运算对象转换



# 二. 优先级、结合律、求值顺序

以一个例子来具体解释以下三者如何影响表达式的值：

```c++
f() + g() * h() + j();
```

首先根据**优先级**判断：表达式应该先执行`*`操作符和`g()`和`h()`的运算，然后执行两个`+`操作符的运算；

在执行完乘法之后，就应该判断两个`+`操作应该先做哪一个，根据`+`操作符的**结合律**应该先执行左侧的`+`操作符和其两个操作数的运算；

另外，在执行每一次运算时，都应该考虑**求值顺序**的问题，`*`操作符和`+`操作符都没有规定其求值顺序，具体反映如下：

- 第一步：`*`操作，由于未规定左右操作数应该先对谁进行求值，所以是未定义的，编译器可能先对`g()`求值，也可能先对`h()`求值。
- 第二步：左侧的`+`操作，由于未规定求值顺序，所以是未定义的，编译器可能先对`f()`求值，也可能先对`g() * h()`求值
- 第三步：右侧的`+`操作，和上述相同，编译器可能先对`j()`求值，也可能先对前面部分求值

这些操作都未定义求值顺序，如果各个函数执行的先后顺序不会影响其结果，则求值顺序无影响；而如果某个函数执行以后会影响另一个函数的求值结果，那么此时该表达式将是一条错误的表达式，将产生未定义的行为。

所有的运算符中只有 4 种明确规定了运算对象的求值顺序：

- 逻辑与`&&`运算符：它规定先求左侧运算对象的值，只有当左侧运算对象的值为真时才继续求右侧运算对象的值
- 逻辑或`||`运算符
- 条件`?:`运算符
- 逗号`,`运算符



# 三. 运算对象转换

在表达式求值的过程中，运算对象常常由一种类型转换成另外一种类型。例如，尽管一般的二元运算符都要求两个运算对象的类型相同，但是很多时候即使运算对象的类型不相同也没有关系，只要它们能转换成同一种类型即可。

## 1. 类型转换的发生情形

- 当在程序的某处使用了一种算术类型的值而其实所需的是另一种类型的值时
- 当表达式里既有有符号类型又有无符号类型，带符号类型会转换成无符号类型



## 2. 类型转换的转换行为

### 算术类型间的类型转换

- 非布尔类型与布尔类型的转换
  - 非 0 $\longrightarrow$ 布尔：转换为`true`
  - 0 $\longrightarrow$ 布尔：转换为`false`
  - `true` $\longrightarrow$ 非布尔：转换为 1
  - `false` $\longrightarrow$ 非布尔：转换为 0
- 浮点类型与整数类型的转换
  - 浮点 $\longrightarrow$ 整数：只保留整数部分。如果整数部分大小超过目标整数类型大小可能产生截断。
  - 整数 $\longrightarrow$ 浮点：整数部分不变，小数部分记为 0。如果整数的二进制位数超过浮点类型的有效数字位数则可能损失精度。
- 无符号与有符号的转换
  - 有符号 $\longrightarrow$ 无符号：最终保存的数据是有符号值本身（非负数）或者加上该类型的可表示的数据个数（负数），如把 -32 (`signed char`) 转换为无符号则为 `-32 + 256 = 224`
  - 无符号 $\longrightarrow$ 有符号：若无符号数的数据在有符号数的范围内则直接保存，若无符号数的数据在有符号数的范围外则参考有符号数的溢出。
- 无符号与有符号的溢出
  - 无符号溢出：最终保存的数据是初始数据对无符号类型的大小取模，如把 256 赋给`unsigned char`则得到`256 % 255 = 1`
  - 有符号溢出：该结果是未定义的，程序可能继续工作、可能崩溃，也可能生成垃圾数据。

### 指针类型相关转换

- 指针与布尔值的转换
  - 空指针（0）$\longrightarrow$ 布尔：转换为`false`
  - 非空指针（非 0）$\longrightarrow$ 布尔：转换为`true`
- 空类型指针转换：空类型指针可以转换为其他任何类型的指针
- 数组与指针的转换：多数时候，在表达式中，数组名会转换为指向数组元素的常量指针
