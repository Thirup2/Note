# 一. 简介

使用文件IO首先需要包含头文件`<fstream>`，其中有三个类型来支持文件IO：

- `ifstream`：从一个给定文件读取数据
- `ofstream`：向一个给定文件写入数据
- `fstream`：读写给定文件

对于文件IO的各种操作，首先对于标准IO中有的操作，文件IO都有，如：`<<`、`>>`和`getline`

另外，还有一些文件IO特有的操作，其中`fios`是一个文件IO类型，`fstrm`是一个文件IO类型的对象，`s`是一个文件的名称，`mode`是打开文件的方式：

| 操作                   | 效果                                                         |
| ---------------------- | ------------------------------------------------------------ |
| `fios fstrm;`          | 创建一个未绑定的文件流。                                     |
| `fios fstrm(s);`       | 创建一个文件流，并打开名为`s`的文件。<br />`s`可以是`string`类型，或者是一个指向C风格字符串的指针。<br />这些构造函数都是`explicit`的。默认的文件模式`mode`依赖于`fios`的类型。 |
| `fios fstrm(s, mode);` | 与前一个构造函数类似，但按指定`mode`打开文件                 |
| `fstrm.open(s)`        | 打开名为`s`的文件，并将文件与`fstrm`绑定。<br />`s`可以是一个`string`或一个指向C风格字符串的指针。<br />默认的文件`mode`依赖于`fios`的类型。返回`void` |
| `fstrm.open(s, mode)`  | 与前一个成员函数类似，但按指定`mode`打开文件                 |
| `fstrm.close()`        | 关闭与`fstrm`绑定的文件。返回`void`                          |
| `fstrm.is_open()`      | 返回一个`bool`值，指出与`fstrm`关联的文件是否成功打开且尚未关闭 |



# 二. 使用文件流对象

创建文件流对象时，我们可以提供文件名（可选的）。如果提供一个文件名，则`open`会自动被调用，即

```c++
ifstream in(ifile)；
```

该操作将会将建一个`ifstream`对象并自动调用`open`打开`ifile`并让`in`与其绑定。

使用文件流时，有一些要点：

- 打开文件时，若文件不存在则会创建该文件。
- 对于接受`ostream&`参数的函数来说，由于继承的原因，该参数可以传入一个`ofstream`对象；对于`istream`和`ifstream`类似。
- 如果调用`open`失败，该IO流的`failbit`会被置位。通常，对一个已经打开的文件流调用`open`会失败，并会导致`failbit`被置位。所以为了将文件流关联到另外一个文件，必须首先关闭已经关联的文件。
- 当同一个作用域中同名的相同类型文件流被创建时，前一个创建的文件流会被销毁，当一个`fstream`对象被销毁时，`close`会自动被调用。故若在循环体内创建一个文件流循环不断打开不同的文件，则不需要进行`close`操作，因为在下一次循环中会对上一个流进行销毁。



# 三. 文件模式

每个流都有一个关联的**文件模式**（file mode），用来指出如何使用文件，如下表所示：

| 文件模式 | 含义                         |
| -------- | ---------------------------- |
| `in`     | 以读方式打开                 |
| `out`    | 以写方式打开                 |
| `app`    | 每次写操作前均定位到文件末尾 |
| `ate`    | 打开文件后立即定位到文件末尾 |
| `trunc`  | 截断文件                     |
| `binary` | 以二进制方式进行IO           |

无论用哪种方式打开文件，我们都可以指定文件模式，但是文件模式的使用有一些限制：

- 只可以对`ofstream`或`fstream`对象设定`out`模式
- 只可以对`ifstream`或`fstream`对象设定`in`模式
- 只有当`out`也被设定时才可设定`trunc`模式
- 只要`trunc`没被设定，就可以设定`app`模式。在`app`模式下，即使没有显式指定`out`模式，文件也总是以输出方式被打开
- 默认情况下，即是我们没有指定`trunc`，以`out`模式打开的文件也会被截断。为了保留以`out`模式打开的文件的内容，我们必须同时指定`app`模式，这样只会将数据追加写到文件末尾；或者同时指定`in`模式，即打开文件同时进行读写操作
- `ate`和`binary`模式可用于任何类型的文件流对象，且可以与其他任何文件模式组合使用。

每个文件流都定义了一个默认的文件模式，当我们未指定文件模式时，就使用此默认模式。与`ifstream`关联的文件默认以`in`模式打开；与`ofstream`关联的文件默认以`out`模式打开；与`fstream`关联的文件默认以`in`和`out`模式打开。

同时，需要注意：

- 以`out`模式打开文件会丢弃已有数据，保留数据的唯一方式是同时指定`app`或`in`模式
- 同时指定多个模式使用`|`运算符连接多个模式
- 每次调用`open`时都会确定文件模式，即在每次打开文件时，都要设置文件模式，可能是显式地设置，也可能是隐式地设置。当程序未指定模式时，就使用默认值。