向容器中添加元素和从容器中删除元素的操作可能会使指向容器元素的指针、引用或迭代器失效。

一个失效的指针、引用或迭代器将不再表示任何元素。使用失效的指针、引用或迭代器是一种严重的程序设计错误，很可能引起与使用未初始化指针一样的问题。

# 一. 失效情形

迭代器失效可能发生于以下情形：

**在向容器添加元素后**：

- 如果容器是`vector`或`string`，且存储空间被重新分配，则指向容器的迭代器、指针和引用都会失效。

  如果存储空间未重新分配，指向插入位置之前的元素的迭代器、指针和引用仍有效，但指向插入位置之后元素的迭代器、指针和引用将会失效

- 对于`deque`，插入到除首尾位置之外的任何位置都会导致迭代器、指针和引用失效。

  如果在首尾位置添加元素，迭代器会失效，但指向存在的元素的引用和指针不会失效

- 对于`list`和`forward_list`，指向容器的迭代器（包括尾后迭代器和首前迭代器）、指针和引用仍有效

**当我们从一个容器中删除元素后**：

- 指向被删除元素的迭代器、指针和引用会失效

- 对于`list`和`forward_list`，指向容器其他位置的迭代器（包括尾后迭代器和首前迭代器）、引用和指针仍有效

- 对于`deque`，如果在首尾之外的任何位置删除元素，那么指向被删除元素外其他元素的迭代器、引用和指针会失效。

  如果是删除`deque`的尾元素，则尾后迭代器也会失效，但其他迭代器、引用和指针不受影响；

  如果是删除首元素，这些也不会受影响。

- 对于`vector`和`string`，指向被删元素之前元素的迭代器、引用和指针仍有效。

  而尾后迭代器总是会失效



# 二. 管理迭代器

当使用迭代器（或指向容器元素的引用或指针）时，最小化要求迭代器必须保持有效的程序片段是一个好的方法。

由于向迭代器添加元素和从迭代器删除元素的代码可能会使迭代器失效，因此**必须保证每次改变容器的操作之后都正确地重新定位迭代器**。这个建议对`vector`、`string`和`deque`尤为重要。