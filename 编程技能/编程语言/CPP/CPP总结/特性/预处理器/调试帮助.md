# 一. 简介

C++ 程序可以通过一种方法进行调试。基本思想是：程序可以包含一些用于调试的代码，但是这些代码只在开发程序中使用。当应用程序编写完成准备发布时，要先屏蔽掉调试代码。这种方法需要用到两项预处理功能：`assert`和`NDEBUG`



# 二. assert预处理宏

`assert`是一种**预处理宏**（preprocessor macro），其行为类似于内联函数，用法则类似于函数调用。

要使用`assert`宏，首先需要包含`<cassert>`头文件，然后就能直接使用`assert`宏了。

****

**使用**：

`assert`宏使用一个表达式作为它的条件：

```c++
assert(expr);
```

这条语句的行为是：首先对`expr`求值，如果表达式为假（即 0），`assert`输出信息并终止程序的运行。如果表达式为真（即非 0），`assert`什么也不做。

****

**用途**：

`assert`宏常用于检查 “不能发生” 的条件，即这个条件一旦发生，可能导致巨大的损失。

在这种条件发生之前先添加一个`assert`宏语句检查此次是否符合这个条件，如果符合，那么就不能继续往下运行了，否则将导致损失；而如果不符合，那说明继续往下运行也没问题。



# 三. NDEBUG预处理变量

`assert`是否工作依赖于一个名为`NDEBUG`的预处理变量的状态。

如果定义了`NDEBUG`，则`assert`什么也不做。默认状态下没有定义`NDEBUG`，此时`assert`将执行运行时检查。

在调试完成之后，我们有两种方法可以定义`NDEBUG`，从而关闭调试状态：

- 可以使用`#define`定义`NDEBUG`，这种方法需要在每个文件中定义一次或定义在头文件中

- 可以使用编译器的命令行定义预处理变量：

  ```bash
  $ CC -D NDEBUG main.c
  ```

  这是`CC`编译器定义预处理变量的方法，即`-D`后跟上需要定义的预处理变量名

****

**自己的条件调试代码**：

`NDEBUG`除了用于`assert`之外，也可以用于编写自己的条件调试代码。如：

```c++
void print(const int ia[], size_t size)
{
#ifndef NDEBUG
    cerr << __func__ << ": array size is " << size << endl;
#endif
    // ...
}
```

上面这段代码表示在调试阶段调用该函数将首先打印一行内容表示数组的大小，其中`__func__`是 C++ 编译器定义的一个局部静态变量，表示当前函数的名字。除了这个变量之外，预处理器还定义了 4 个对于程序调试很有用的名字：

- `__FILE__`：存放文件名的字符串字面值
- `__LINE__`：存放当前行号的整型字面值
- `__TIME__`：存放文件编译时间的字符串字面值
- `__DATE__`：存放文件编译日期的字符串字面值