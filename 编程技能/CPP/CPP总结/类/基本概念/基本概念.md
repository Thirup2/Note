# 一. this指针

## 1. 作为参数

`this`指针是一个指向类对象的指针，对于成员函数来说，虽然没有显式声明这个指针，但是实际上传入了这个指针。在类定义中，这个指针没有具体指向的对象。在调用成员函数时，会用请求该函数的对象地址来初始化`this`指针。

在成员函数中可以通过`this`指针来访问类的数据成员，如：`(*this).data`或`this->data`。我们也可以直接在成员函数中使用数据成员的名字来访问数据成员，这会被看作`this`的隐式引用。

同时，任何自定义名为`this`的参数或变量的行为都是非法的。

另外，`this`是一个常量指针，我们不允许改变`this`中保存的地址。

## 2. 作为返回

首先`this`是指向类的指针，我们可以返回某个类型的指针，此时将返回类型定义为：`ClassName *`即可，返回时直接返回`this`即可。

有时，我们需要返回的是对象本身，但是有几个问题，其一是一般类类型对象所占用的内存都比较大，要拷贝一个对象其消耗比一般的大；第二是拷贝所传的是对象的值而非对象本身，然而有时我们需要的就是对象其本身；第三是某些类根本就不允许拷贝。综合这三点，我们可以使用另一个更好的方案，就是传引用。

所以，对应的返回类型应该是`ClassName &`类型，然后返回值应该是对象本身或者一个与对象绑定的引用，一般情况下，我们可以用`*this`来获取该对象的实体，然后被转换为引用。

### 从const成员函数返回this指针

`const`成员函数会将默认传入的`this`指针设置为底层`const`的，意味着我们无法返回一个非底层`const`的`this`指针，因为由底层向非底层的转换是非法的，除非使用强制类型转换。但我们有时会同时有这种需求，即同时要求既是`const`成员函数，又要返回一个非底层`const`的`this`指针。

所以我们现在的需求应该是这样的，对于本身具有底层`const`的`this`指针，我们应该照常返回一个底层`const`的`this`指针，因为我们在类设计的层面可以认为用户不会对类数据进行修改。而对于本身不具有底层`const`的`this`指针，我们应该返回一个非底层`const`的`this`指针。

此时的解决方法是重载函数，及设置两个同名函数，一个`const`成员函数，一个非`const`成员函数，二者在函数内进行一些处理，使之能够完美完成任务，同时`const`成员函数应该返回一个底层`const`的`this`指针，非`const`成员函数应该返回一个非底层`const`的`this`指针，如下例所示：

```c++
class Screen
{
public:
    Screen &display(std::ostream &os)
    {
        do_display(os);
        return *this;
    }
    const Screen &display(std::ostream &os) const
    {
        do_display(os);
        return *this;
    }
private:
    void do_display(std::ostream &os) const
    {
        os << contents;
    }
};
```



# 二. 类定义方法

## 1. 类声明

类也可以只声明而暂时不定义，就像函数那样：

```c++
class Screen;			// 声明了一个Screen类
```

这种声明有时被称作**前向声明**，它向程序引入了名字`Screen`并且指明`Screen`是一种类类型。

对于类型`Screen`来说，在它声明之后定义之前是一个**不完全类型**，即不知道其成员。

不完全类型只能在以下情景使用：

- 可以定义指向这种类型的指针或引用
- 可以声明（但是不能定义）以不完全类型作为参数或者返回类型的函数

以下是不能使用不完全类型的典型情况：

- 创建不完全类型的对象，因为不知道其大小
- 不能访问其成员



## 2. 类定义

一个类的定义由以下几部分组成：

- 数据成员
- 成员函数
- 构造、拷贝、赋值与析构函数
- 友元声明
- 访问说明符

其格式大致如下：

```c++
class ClassName
{
    friend RetType Function1(<Para-List>);
    friend RetType Function2(<Para-List>);
    /* ... */
    
public:
    ClassName() = default;
    ClassName(<Para-List>)< : Init-List> {/* 函数体 */};
    ClassName(<Para-List2>);
    /* ... */
    
    RetType Function3(<Para-List>) {/* 函数体 */};
    RetType Function4(<Para-List>);
    /* ... */
    
private:
    Type Value1;
    Type Value2;
    /* ... */
};

/* 非成员函数定义 */
friend RetType Function1(<Para-List>) {/* 函数体 */}
friend RetType Function2(<Para-List>) {/* 函数体 */}

/* 构造函数定义 */
ClassName::ClassName(<Para-List2>) < : Init-List> {/* 函数体 */}

/* 成员函数定义 */
RetType ClassName::Function4(<Para-List>) {/* 函数体 */}
```

