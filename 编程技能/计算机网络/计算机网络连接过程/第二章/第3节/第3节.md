## 一. 基础知识
1. 创建包: 生成含有控制信息的头部, 然后附加上要发送的数据
    - 首先是TCP部分, 添加TCP头部, 然后与数据块生成第一层次的包
    - 然后是IP部分, 添加IP头部与MAC头部, 与第一层的包生成第二层次的包
        - TCP/IP包: 包括MAC头部与IP头部与第一层次的包
        - IP包: 包括IP头部与第一层次包
        - 以太网包: 等同于TCP/IP包
2. IP协议: 根据目标地址判断下一个IP转发设备的位置
3. 以太网协议: 子网中的以太网协议将包传输到下一个转发设备
4. 路由器: 按照IP规则传输包
5. 集线器: 按照以太网规则传输包
6. 整体工作
    - IP协议根据IP头部查找下一个路由器的位置, 并将其以太网地址(MAC地址)写入MAC头部
    - 以太网协议通过MAC头部发送包到下一个路由器
    - 途中经过集线器, 集线器继续通过MAC协议发送包
    - 最后到达目的地
## 二. IP工作
1. TCP委托IP模块发送数据, 并传递IP地址
2. 添加IP头部
    - 接收方IP地址
    - 发送方IP地址: 根据路由表判断选哪一块网卡的IP地址
    - 填写协议号: TCP或UDP
    - 其他头部字段
3. 生成MAC头部
    - 接收方MAC地址: 通过路由表找到对应的路由器地址
    - 发送方MAC地址: 网卡本身的MAC地址
    - 以太类型: IP, ARP等
## 三. 网卡工作
1. 给网络包添加3个控制数据
    - 报头: 确定包的读取时机
    - 起始帧分界符: 用来表示包起始位置的标记
    - 帧校验序列(FCS): 用来检查包传输过程中因噪声导致的波形紊乱和数据错误
2. 将IP包转换成电或光信号并发送出去
    - MAC模块从报头开始将数字信息按每个比特转换成电信号
    - PHY(MAU)信号收发模块将信号转换为可在网线上传输的格式
    - PHY(MAU)模块通过网线将信号发送出去
3. 接收返回包
    * PHY(MAU)模块将信号转换为通用信号发送给MAC模块
    * MAC模块将通用信号转换为数字信息, 并存放到缓冲区
    * 检查FCS
    * 判断MAC头部中接收方和自身的MAC地址是否吻合
    * 通过"中断"调用网卡驱动程序
    * 驱动程序从网卡的缓冲区取出收到的包
    * 通过MAC头部中的以太类型判断协议类型
    * 交给协议栈
    * IP模块检查IP头部
    * IP模块查看接收方IP地址是否与自身一致
    * IP模块将经过分片的包还原成原始的包
    * IP模块将包移交给TCP模块
    * TCP模块查找对应的套接字
    * 根据套接字执行相应操作